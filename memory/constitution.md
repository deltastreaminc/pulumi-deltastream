## Project Constitution (Governance & Memory)
This document is NOT a feature spec. It is a governance artifact describing how specs are created, evolved, referenced, and enforced. It adapts principles from GitHub's spec-kit (see external `spec-driven.md`) to this project context.

### 1. Purpose
Provide a durable, minimal, auditable source of: principles, decision clauses, and consumption order so humans and automation reach consistent outcomes.

### 2. Hierarchy of Truth
1. Constitution (this file) – meta rules & enduring principles.
2. Accepted Specs – canonical feature intent.
3. Draft / In-Review Specs – emerging intent; lower precedence on conflicts.
4. Issues / Discussions – raw signal; not authoritative unless codified.
5. Code – factual implementation; never retroactively overrides accepted intent without spec update.

### 3. Core Principles
CLAUSE-001 Immutability over silent drift: once a spec is Accepted, behavior changes require a new spec revision.
CLAUSE-002 Explicit ambiguity tagging: any uncertainty MUST use `[NEEDS CLARIFICATION: …]` and blocks acceptance.
CLAUSE-003 Minimal surface: remove obsolete rules fast to reduce parsing burden.
CLAUSE-004 One source per rule: every clause cites an origin (spec id, issue, PR, or decision record).
CLAUSE-005 Safety first: security / data integrity requirements outrank performance tweaks unless explicitly reversed.
CLAUSE-006 Deterministic automation: agents must ground actions citing clause or spec requirement IDs.
CLAUSE-007 Human override path: urgent fixes may proceed with a temporary `WAIVER-XXXX` recorded and timeboxed.

### 4. Clause Format
`CLAUSE-###` sequential, zero‑padded. Supersession recorded via `Superseded-By: CLAUSE-XYZ` inline after original text. Deprecated clauses remain for traceability until next pruning cycle.

### 5. Decision Records (DR)
Lightweight inline list instead of separate ADR folder for now.
Format: `DR-YYYYMMDD-XX: <title>` followed by context, decision, consequences. Each DR may introduce or supersede clauses.

### 6. Spec Lifecycle
States: Draft → Review → Accepted → (Superseded | Deprecated).
Entry conditions for Acceptance: (a) No `[NEEDS CLARIFICATION]` markers, (b) Requirements testable, (c) Risks addressed, (d) Checklist completed.

### 7. Agent Consumption Order
When executing or modifying code, agents resolve intent in this sequence: Constitution → Accepted Spec → Most recent Draft Spec (if feature not yet accepted) → Code → Maintainer prompt.

### 8. Ambiguity Handling
If ambiguity detected and no clause covers it, agent MUST: (1) Insert `[NEEDS CLARIFICATION: <summary>]` in relevant draft spec or propose a new clause; (2) Reference where encountered; (3) Halt acceptance escalation until resolved.

### 9. Supersession & Pruning
Monthly review: remove fully superseded clauses older than 2 review cycles unless historically significant. Keep a DR entry logging removal.

### 10. Index of Accepted Specs
| Spec | Status | Notes |
|------|--------|-------|
| database.md | Accepted | Labels out of scope |
| namespace.md | Accepted | — |
| object.md | Accepted | Schema immutable |
| query.md | Accepted | Body immutable |
| store.md | Draft | Subtype criteria unresolved |
| invokes.md | Draft | Plural scope question |
| platform-ci-security.md | Draft | Pending refactor |

### 11. Contribution Workflow
1. Create / update spec using template.
2. Mark open uncertainties with markers.
3. Submit PR referencing any new clauses required.
4. Reviewers ensure hierarchy not violated.
5. Merge when checklist complete → Update Index.

### 12. Temporary Waivers
Format: `WAIVER-YYYYMMDD-XX` with scope, rationale, expiry ≤ 30 days. Must link to follow-up issue. Waivers tracked below:
None active.

### 13. Lint & Automation (Planned)
- Validate clause id uniqueness.
- Fail CI if Accepted spec contains `[NEEDS CLARIFICATION]`.
- Warn if Draft older than 60 days with unresolved markers.

### 14. Open Governance Decisions
CLAUSE-008 Clause namespace remains flat (no hierarchical prefixes) to minimize cognitive load and simplify automated parsing (Decision: DR-20250904-02).
CLAUSE-009 Spec index (Section 10) MUST be auto-regenerated by a CI script scanning `specs/` for `Status:` lines; manual edits to the table are prohibited (Decision: DR-20250904-02).

### 15. Decision Records
DR-20250904-01: Establish constitution initial version (introduces CLAUSE-001..007). Consequence: Agents must cite clauses.
DR-20250904-02: Resolve governance questions: (a) retain flat clause namespace (introduces CLAUSE-008), (b) enforce automated spec index regeneration (introduces CLAUSE-009). Consequence: PRs modifying index manually should fail CI; tooling update required.

### 16. Maintenance Cadence
Monthly: prune superseded, review waivers, refresh index, resolve stale ambiguity markers.

### 17. Change Proposal Checklist
- [ ] Clause ids sequential & unique
- [ ] Source references present
- [ ] No mixing governance + feature requirements
- [ ] Index updated if status changes
- [ ] No unresolved markers in sections promoted to Acceptance

### 18. Governance Status
Status: Draft (evolving). Pending: implement CI automation for index (CLAUSE-009) before marking Accepted.

### 19. Appendix
Potential future externalization to ADR directory; keep single-file until > 25 DR entries.
